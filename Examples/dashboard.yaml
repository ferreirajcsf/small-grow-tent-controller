# Example Lovelace dashboard for: Small Grow Tent Controller
#
# This file is an example only. It is NOT installed/loaded automatically by HACS.
#
# Dependencies (custom cards):
# - layout-card (grid-layout)
# - Mushroom cards
# - button-card
# - card-mod
#
# Usage:
# 1) Home Assistant → Settings → Dashboards → Add Dashboard → YAML mode
# 2) Copy/paste this file into the dashboard YAML editor
# 3) Update the entity IDs in the "Entity IDs you must change" section below to match your setup.
#
# Entity IDs you must change (common ones vary by user):
# - switch.lightgrowtent
# - switch.heatergrowtent
# - switch.ventilationgrowtent
# - switch.exhaustgrowtent
# - sensor.canopy_temperature / sensor.top_temperature / sensor.canopy_humidity / sensor.top_humidity
# - input_datetime.* / input_number.* (if you don't have these helpers)
#
title: Grow Tent
views:
  - title: Controller
    path: grow-tent
    icon: mdi:sprout
    cards:
      - type: custom:layout-card
        layout_type: custom:grid-layout
        layout:
          grid-template-columns: 1fr 1fr 1fr
          grid-template-rows: auto auto auto auto auto auto
          grid-template-areas: |
            "small calc devices"
            "tuning env limits"
            "cycle cycle cycle"
            "trend1 trend2 trend3"
            "debug debug debug"
          grid-column-gap: 12px
          grid-row-gap: 12px
          grid-auto-rows: minmax(260px, auto)
        cards:
          - type: vertical-stack
            view_layout:
              grid-area: small
            cards:
              - type: custom:mushroom-title-card
                title: Small Grow Tent
                alignment: center
              - type: custom:button-card
                show_icon: false
                show_name: false
                show_state: false
                tap_action:
                  action: none
                styles:
                  card:
                    - background: none
                    - box-shadow: none
                    - padding: 0px 0px 6px 0px
                    - border-radius: 0px
                    - display: grid
                    - grid-template-areas: '"line"'
                    - grid-template-columns: 1fr
                    - place-items: start
                  custom_fields:
                    line:
                      - grid-area: line
                      - justify-self: start
                      - align-self: center
                      - text-align: left
                      - font-size: 14px
                      - line-height: 1.2
                      - color: var(--secondary-text-color)
                      - white-space: normal
                custom_fields:
                  line: |
                    [[[
                      const raw = (states['sensor.control_mode']?.state ?? '').toString();
                      const stage = (states['select.stage']?.state ?? 'Unknown').toString();

                      if (!raw || raw === 'unknown' || raw === 'unavailable') {
                        return `
                          <span style="font-weight:700;">Mode:</span>
                          <span> ${raw || 'unknown'}</span>
                          <span> • Stage: ${stage}</span>
                        `;
                      }

                      const m = raw.toLowerCase();
                      let label = raw;
                      let color = 'var(--secondary-text-color)';

                      if (m === 'vpd_chase') { label = 'VPD chase'; color = '#4CAF50'; }
                      else if (m.startsWith('hard_limit:temp_above')) { label = 'Temp too hot'; color = '#F44336'; }
                      else if (m.startsWith('hard_limit:rh_above')) { label = 'RH too high'; color = '#2196F3'; }
                      else if (m.startsWith('hard_limit:temp_below')) { label = 'Temp too cold'; color = '#FFC107'; }
                      else if (m.startsWith('hard_limit:rh_below')) { label = 'RH too low'; color = '#9C27B0'; }
                      else if (m.includes('dewpoint_protect') || m.includes('dew_point_protect')) {
                        label = 'Dew point protect';
                        color = '#00BCD4';
                      }
                      else if (m.startsWith('night_')) {
                        label = raw.replaceAll('_', ' ');
                        color = '#90A4AE';
                      }

                      return `
                        <span style="font-weight:700;">Mode:</span>
                        <span style="color:${color};"> ${label}</span>
                        <span> • Stage: ${stage}</span>
                      `;
                    ]]]
              - type: custom:mushroom-chips-card
                alignment: justify
                chips:
                  - type: entity
                    entity: switch.controller
                    icon: mdi:robot
                    name: Controller
                    content_info: name
                    tap_action:
                      action: toggle
                  - type: entity
                    entity: select.stage
                    icon: mdi:sprout
                    name: Stage
                    content_info: name
                    tap_action:
                      action: more-info
                  - type: entity
                    entity: sensor.vpd
                    icon: mdi:chart-bell-curve-cumulative
                    name: VPD
                    content_info: state
                  - type: entity
                    entity: sensor.dew_point
                    icon: mdi:weather-fog
                    name: Dew
                    content_info: state
              - type: custom:layout-card
                layout_type: grid
                layout:
                  grid-template-columns: repeat(2, 1fr)
                  grid-auto-rows: 116px
                  grid-column-gap: 12px
                  grid-row-gap: 12px
                cards:
                  - type: custom:mushroom-entity-card
                    entity: time.light_on_time
                    name: Light On
                    icon: mdi:weather-sunny
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: time.light_off_time
                    name: Light Off
                    icon: mdi:weather-night
                    fill_container: true
          - type: vertical-stack
            view_layout:
              grid-area: calc
            cards:
              - type: custom:mushroom-title-card
                title: Calculations
                subtitle: Averages + VPD
                alignment: center
              - type: custom:layout-card
                layout_type: grid
                layout:
                  grid-template-columns: repeat(2, 1fr)
                  grid-auto-rows: 116px
                  grid-column-gap: 12px
                  grid-row-gap: 12px
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.average_temperature
                    name: Avg Temp
                    icon: mdi:thermometer
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.average_humidity
                    name: Avg RH
                    icon: mdi:water-percent
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.vpd
                    name: VPD
                    icon: mdi:chart-bell-curve-cumulative
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.dew_point
                    name: Dew Point
                    icon: mdi:weather-fog
                    fill_container: true
          - type: vertical-stack
            view_layout:
              grid-area: devices
            cards:
              - type: custom:mushroom-title-card
                title: Devices
                subtitle: Smart plug controls
                alignment: center
              - type: custom:layout-card
                layout_type: grid
                layout:
                  grid-template-columns: repeat(2, 1fr)
                  grid-auto-rows: 116px
                  grid-column-gap: 12px
                  grid-row-gap: 12px
                cards:
                  - type: custom:mushroom-entity-card
                    entity: switch.lightgrowtent
                    name: Grow Light
                    icon: mdi:lightbulb-on-10
                    tap_action:
                      action: toggle
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: switch.heatergrowtent
                    name: Heater
                    icon: mdi:radiator
                    tap_action:
                      action: toggle
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: switch.ventilationgrowtent
                    name: Circulation Fan
                    icon: mdi:fan
                    tap_action:
                      action: toggle
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: switch.exhaustgrowtent
                    name: Exhaust Fan
                    icon: mdi:fan-chevron-up
                    tap_action:
                      action: toggle
                    fill_container: true
          - type: vertical-stack
            view_layout:
              grid-area: cycle
            cards:
              - type: custom:mushroom-title-card
                title: Grow Cycle
                subtitle: Dates + counters
                alignment: center
              - type: custom:layout-card
                layout_type: grid
                layout:
                  grid-template-columns: repeat(6, minmax(0, 1fr))
                  grid-auto-rows: 116px
                  grid-column-gap: 12px
                  grid-row-gap: 12px
                cards:
                  - type: custom:mushroom-entity-card
                    entity: input_datetime.grow_germination_date
                    name: Germination
                    icon: mdi:seed
                    fill_container: true
                  - type: custom:mushroom-number-card
                    entity: input_number.grow_plant_count
                    name: Plants
                    icon: mdi:sprout
                    display_mode: buttons
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: input_datetime.grow_flowering_start_date
                    name: Flower Start
                    icon: mdi:flower-outline
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.grow_days_since_germination
                    name: Since Germ
                    icon: mdi:timer-sand
                    fill_container: true
                  - type: custom:mushroom-number-card
                    entity: input_number.grow_total_flower_days
                    name: Flower Days
                    icon: mdi:calendar-range
                    display_mode: buttons
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.grow_days_until_harvest
                    name: To Harvest
                    icon: mdi:calendar-end
                    fill_container: true
          - type: vertical-stack
            view_layout:
              grid-area: tuning
            cards:
              - type: custom:mushroom-title-card
                title: Tuning / Safety
                subtitle: Anti-cycling + dew-point protection
                alignment: center
              - type: custom:layout-card
                layout_type: grid
                layout:
                  grid-template-columns: repeat(2, 1fr)
                  grid-auto-rows: 116px
                  grid-column-gap: 12px
                  grid-row-gap: 12px
                cards:
                  - type: custom:mushroom-number-card
                    entity: number.leaf_temp_offset
                    name: Leaf Temp Offset
                    icon: mdi:leaf
                    display_mode: slider
                    fill_container: true
                    card_mod:
                      style: |
                        ha-card {
                          padding-top: 8px !important;
                          padding-bottom: 8px !important;
                        }
                        ha-card ha-slider,
                        ha-card mwc-slider {
                          --mdc-slider-active-track-height: 2px;
                          --mdc-slider-inactive-track-height: 2px;
                          --mdc-slider-track-height: 2px;
                          --mdc-slider-handle-size: 14px;
                          --mdc-slider-thumb-size: 14px;
                        }
                  - type: custom:mushroom-number-card
                    entity: number.vpd_deadband
                    name: VPD Deadband
                    icon: mdi:arrow-expand-vertical
                    display_mode: slider
                    fill_container: true
                    card_mod:
                      style: |
                        ha-card {
                          padding-top: 8px !important;
                          padding-bottom: 8px !important;
                        }
                        ha-card ha-slider, ha-card mwc-slider {
                          --mdc-slider-active-track-height: 2px;
                          --mdc-slider-inactive-track-height: 2px;
                          --mdc-slider-track-height: 2px;
                          --mdc-slider-handle-size: 14px;
                          --mdc-slider-thumb-size: 14px;
                        }
                  - type: custom:mushroom-number-card
                    entity: number.dew_point_margin
                    name: Dew Margin
                    icon: mdi:weather-fog
                    display_mode: slider
                    fill_container: true
                    card_mod:
                      style: |
                        ha-card {
                          padding-top: 8px !important;
                          padding-bottom: 8px !important;
                        }
                        ha-card ha-slider,
                        ha-card mwc-slider {
                          --mdc-slider-active-track-height: 2px;
                          --mdc-slider-inactive-track-height: 2px;
                          --mdc-slider-track-height: 2px;
                          --mdc-slider-handle-size: 14px;
                          --mdc-slider-thumb-size: 14px;
                        }
                  - type: custom:mushroom-number-card
                    entity: number.exhaust_hold_time
                    name: Exhaust Hold (s)
                    icon: mdi:fan-chevron-up
                    display_mode: slider
                    fill_container: true
                    card_mod:
                      style: |
                        ha-card {
                          padding-top: 8px !important;
                          padding-bottom: 8px !important;
                        }
                        ha-card ha-slider,
                        ha-card mwc-slider {
                          --mdc-slider-active-track-height: 2px;
                          --mdc-slider-inactive-track-height: 2px;
                          --mdc-slider-track-height: 2px;
                          --mdc-slider-handle-size: 14px;
                          --mdc-slider-thumb-size: 14px;
                        }
                  - type: custom:mushroom-number-card
                    entity: number.heater_hold_time
                    name: Heater Hold (s)
                    icon: mdi:radiator
                    display_mode: slider
                    fill_container: true
                    card_mod:
                      style: |
                        ha-card {
                          padding-top: 8px !important;
                          padding-bottom: 8px !important;
                        }
                        ha-card ha-slider,
                        ha-card mwc-slider {
                          --mdc-slider-active-track-height: 2px;
                          --mdc-slider-inactive-track-height: 2px;
                          --mdc-slider-track-height: 2px;
                          --mdc-slider-handle-size: 14px;
                          --mdc-slider-thumb-size: 14px;
                        }
                  - type: custom:mushroom-number-card
                    entity: number.heater_max_run_time
                    name: Heater Max Run (s)
                    icon: mdi:timer-outline
                    display_mode: slider
                    fill_container: true
                    card_mod:
                      style: |
                        ha-card {
                          padding-top: 8px !important;
                          padding-bottom: 8px !important;
                        }
                        ha-card ha-slider,
                        ha-card mwc-slider {
                          --mdc-slider-active-track-height: 2px;
                          --mdc-slider-inactive-track-height: 2px;
                          --mdc-slider-track-height: 2px;
                          --mdc-slider-handle-size: 14px;
                          --mdc-slider-thumb-size: 14px;
                        }
          - type: vertical-stack
            view_layout:
              grid-area: env
            cards:
              - type: custom:mushroom-title-card
                title: Environment
                subtitle: Raw sensors
                alignment: center
              - type: custom:layout-card
                layout_type: grid
                layout:
                  grid-template-columns: repeat(2, 1fr)
                  grid-auto-rows: 116px
                  grid-column-gap: 12px
                  grid-row-gap: 12px
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.canopy_temperature
                    name: Canopy Temp
                    icon: mdi:thermometer
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.top_temperature
                    name: Top Temp
                    icon: mdi:thermometer
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.canopy_humidity
                    name: Canopy RH
                    icon: mdi:water-percent
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.top_humidity
                    name: Top RH
                    icon: mdi:water-percent
                    fill_container: true
          - type: vertical-stack
            view_layout:
              grid-area: limits
            cards:
              - type: custom:mushroom-title-card
                title: Limits (Hard Stop)
                subtitle: When hit, controller stops chasing VPD
                alignment: center
              - type: custom:layout-card
                layout_type: grid
                layout:
                  grid-template-columns: repeat(2, 1fr)
                  grid-auto-rows: 116px
                  grid-column-gap: 12px
                  grid-row-gap: 12px
                cards:
                  - type: custom:mushroom-number-card
                    entity: number.min_temperature
                    name: Min Temp
                    icon: mdi:thermometer-low
                    display_mode: slider
                    fill_container: true
                    card_mod:
                      style: >
                        ha-card { padding-top: 8px !important; padding-bottom:
                        8px !important; } ha-card ha-slider, ha-card mwc-slider
                        {
                          --mdc-slider-active-track-height: 2px;
                          --mdc-slider-inactive-track-height: 2px;
                          --mdc-slider-track-height: 2px;
                          --mdc-slider-handle-size: 14px;
                          --mdc-slider-thumb-size: 14px;
                        }
                  - type: custom:mushroom-number-card
                    entity: number.max_temperature
                    name: Max Temp
                    icon: mdi:thermometer-high
                    display_mode: slider
                    fill_container: true
                    card_mod:
                      style: >
                        ha-card { padding-top: 8px !important; padding-bottom:
                        8px !important; } ha-card ha-slider, ha-card mwc-slider
                        {
                          --mdc-slider-active-track-height: 2px;
                          --mdc-slider-inactive-track-height: 2px;
                          --mdc-slider-track-height: 2px;
                          --mdc-slider-handle-size: 14px;
                          --mdc-slider-thumb-size: 14px;
                        }
                  - type: custom:mushroom-number-card
                    entity: number.min_humidity
                    name: Min RH
                    icon: mdi:water-minus
                    display_mode: slider
                    fill_container: true
                    card_mod:
                      style: >
                        ha-card { padding-top: 8px !important; padding-bottom:
                        8px !important; } ha-card ha-slider, ha-card mwc-slider
                        {
                          --mdc-slider-active-track-height: 2px;
                          --mdc-slider-inactive-track-height: 2px;
                          --mdc-slider-track-height: 2px;
                          --mdc-slider-handle-size: 14px;
                          --mdc-slider-thumb-size: 14px;
                        }
                  - type: custom:mushroom-number-card
                    entity: number.max_humidity
                    name: Max RH
                    icon: mdi:water-plus
                    display_mode: slider
                    fill_container: true
                    card_mod:
                      style: >
                        ha-card { padding-top: 8px !important; padding-bottom:
                        8px !important; } ha-card ha-slider, ha-card mwc-slider
                        {
                          --mdc-slider-active-track-height: 2px;
                          --mdc-slider-inactive-track-height: 2px;
                          --mdc-slider-track-height: 2px;
                          --mdc-slider-handle-size: 14px;
                          --mdc-slider-thumb-size: 14px;
                        }
          - type: history-graph
            view_layout:
              grid-area: trend1
            title: Trend (Temp)
            hours_to_show: 24
            logarithmic_scale: false
            entities:
              - sensor.average_temperature
              - sensor.canopy_temperature
              - sensor.top_temperature
          - type: history-graph
            view_layout:
              grid-area: trend2
            title: Trend (RH)
            hours_to_show: 24
            logarithmic_scale: false
            entities:
              - sensor.average_humidity
              - sensor.canopy_humidity
              - sensor.top_humidity
          - type: history-graph
            view_layout:
              grid-area: trend3
            title: Trend (VPD / Dew)
            hours_to_show: 24
            logarithmic_scale: false
            entities:
              - sensor.vpd
              - sensor.dew_point
          - type: vertical-stack
            view_layout:
              grid-area: debug
            cards:
              - type: custom:mushroom-title-card
                title: Controller Debug
                subtitle: Time + scheduler diagnostics
                alignment: center
              - type: custom:layout-card
                layout_type: grid
                layout:
                  grid-template-columns: repeat(2, 1fr)
                  grid-auto-rows: 116px
                  grid-column-gap: 12px
                  grid-row-gap: 12px
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.controller_local_time
                    name: Local Time
                    icon: mdi:clock-outline
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.controller_local_time_tod
                    name: Time of Day
                    icon: mdi:clock-time-eight-outline
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.light_window
                    name: Light Window
                    icon: mdi:calendar-clock
                    fill_container: true
                  - type: custom:mushroom-entity-card
                    entity: sensor.controller_is_day
                    name: Is Day
                    icon: mdi:white-balance-sunny
                    fill_container: true
    type: custom:grid-layout
